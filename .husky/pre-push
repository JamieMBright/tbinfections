#!/bin/sh

# TB Infections Simulator - Pre-push Hook
# Runs comprehensive checks including build verification before pushing

echo "ğŸš€ Running pre-push checks..."

# Run unit tests
echo "ğŸ§ª Running unit tests..."
npm run test:unit -- --run
if [ $? -ne 0 ]; then
    echo "âŒ Unit tests failed. Please fix failing tests before pushing."
    exit 1
fi

# Verify build succeeds (catches Vercel deployment issues)
echo "ğŸ—ï¸  Verifying production build..."
npm run build
if [ $? -ne 0 ]; then
    echo "âŒ Build failed. This would fail on Vercel deployment."
    echo "   Please fix build errors before pushing."
    exit 1
fi

# Check for dependency issues
echo "ğŸ“¦ Checking for dependency issues..."
npm ls --depth=0 2>&1 | grep -i "UNMET" && {
    echo "âš ï¸  Warning: There are unmet peer dependencies."
    echo "   This may cause issues on Vercel. Consider running 'npm install' again."
}

echo "âœ… Pre-push checks passed! Safe to push."
